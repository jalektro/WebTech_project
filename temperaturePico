import network
import urequests
from time import sleep
from picozero import pico_temp_sensor

# Wi-Fi credentials
ssid = '**' #insert SSID here. 
password = '** ' # hide the password for github, insert pw here 

# Remote server details
REMOTE_SERVER_URL = 'https://server-of-robert.pxl.bjth.xyz/api/v1/temperature.php'

def connect_to_wifi():
    wlan = network.WLAN(network.STA_IF)
    wlan.active(True)
    wlan.connect(ssid, password)
    while not wlan.isconnected():
        print('Connecting to WiFi...')
        sleep(1)
    print('Connected to WiFi:', wlan.ifconfig())
    return wlan.ifconfig()[0]

def send_temperature(temperature):
    headers = {'Content-Type': 'application/json'}
    data = {'temperature': temperature}
    try:
        print(f"Sending data to {REMOTE_SERVER_URL}: {data}")
        response = urequests.post(REMOTE_SERVER_URL, json=data, headers=headers)
        print("Response status:", response.status_code)
        print("Response text:", response.text)
        response.close()
    except Exception as e:
        print("Error sending temperature data:", e)

def read_temperature():
    return pico_temp_sensor.temp

def main():
    connect_to_wifi()
    while True:
        try:
            temperature = read_temperature()
            send_temperature(temperature)
        except Exception as e:
            print("Error:", e)
        sleep(3000)  # Adjust the interval based on your requirements

if __name__ == '__main__':
    main()